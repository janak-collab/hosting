    /**
     * API: Get procedures for a provider (with no-cache headers)
     */
    public function getTemplates() {
        $this->setNoCacheHeaders();
        header('Content-Type: application/json');

        // Note: Removed CSRF check for GET request (GET should be safe/idempotent)

        $providerId = $_GET['provider_id'] ?? null;

        if (!$providerId) {
            $this->jsonResponse([
                'success' => false,
                'error' => 'Provider ID required'
            ], 400);
            return;
        }

        try {
            // Get procedures with provider customizations
            $procedures = $this->dictationModel->getActiveProcedures($providerId);

            // Get billing codes for each procedure
            foreach ($procedures as &$procedure) {
                $procedure['billing_codes'] = $this->dictationModel->getBillingCodes($procedure['id']);
            }

            // Log the action
            $this->dictationModel->createAuditLog([
                'action' => 'load_procedures',
                'provider_id' => $providerId,
                'metadata' => [
                    'procedure_count' => count($procedures)
                ]
            ]);

            $this->jsonResponse([
                'success' => true,
                'procedures' => $procedures
            ]);

        } catch (\Exception $e) {
            error_log("Get templates error: " . $e->getMessage());
            $this->jsonResponse([
                'success' => false,
                'error' => 'Failed to load procedures: ' . $e->getMessage()
            ], 500);
        }
    }
